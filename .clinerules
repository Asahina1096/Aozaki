# .clinerules
# =========================================================
# Komari Aozaki å¼€å‘è§„èŒƒï¼ˆä¼˜åŒ–ç‰ˆï¼‰
# =========================================================
# æŠ€æœ¯æ ˆ: Astro 5.x + React 19 + TypeScript 5.x + TailwindCSS 4.x + shadcn/ui + Recharts 3.x
# åŒ…ç®¡ç†å™¨: Bun 1.3.x
# æœ€åæ›´æ–°: 2025-10-16
# =========================================================

version: 1

# =========================================================
# MCP æœåŠ¡å™¨é…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰
# =========================================================
mcp:
  servers:
    - id: sequentialthinking
      description: æ·±åº¦æ€è€ƒä¸é—®é¢˜åˆ†è§£è¾…åŠ©å·¥å…·
      usage: ç”¨äºå¤æ‚é—®é¢˜åˆ†è§£ã€æ¶æ„è®¾è®¡ã€å¤šæ­¥éª¤è§„åˆ’

    - id: context7
      description: æä¾›è¯­ä¹‰ä¸Šä¸‹æ–‡ä¸æ–‡æ¡£æ£€ç´¢
      usage: ä»£ç æ¨¡å¼ç†è§£ã€è§„åˆ™è§£é‡Šã€ä¸Šä¸‹æ–‡è·å–

    - id: filesystem
      description: æ–‡ä»¶ç³»ç»Ÿçº§åˆ«æ“ä½œéªŒè¯
      usage: æ–‡ä»¶åˆ›å»ºã€æ›´æ–°ã€ç»“æ„éªŒè¯

# =========================================================
# PLAN MODE å·¥ä½œæµè§„èŒƒï¼ˆæ–°å¢ï¼‰
# =========================================================

- id: plan-mode-filesystem-workflow
  description: PLAN MODE ä¸‹ä¸»åŠ¨ä½¿ç”¨ filesystem MCP Server çš„å·¥ä½œæµ
  priority: critical
  mode: PLAN_MODE

  enforce:
    - proactive_file_exploration: true       # ä¸»åŠ¨æ¢ç´¢æ–‡ä»¶
    - use_mcp_filesystem_tools: true         # ä¼˜å…ˆä½¿ç”¨ MCP å·¥å…·
    - gather_context_before_planning: true   # è§„åˆ’å‰æ”¶é›†ä¸Šä¸‹æ–‡
    - read_relevant_files: true              # è¯»å–ç›¸å…³æ–‡ä»¶
    - no_assumptions_without_reading: true   # ä¸åŸºäºå‡è®¾è§„åˆ’

  workflow:
    step_1_task_analysis:
      description: "åˆ†æä»»åŠ¡ï¼Œç¡®å®šéœ€è¦æ¢ç´¢çš„æ¨¡å—"
      actions:
        - "è¯†åˆ«ä»»åŠ¡æ¶‰åŠçš„ç»„ä»¶/æ–‡ä»¶ç±»å‹"
        - "ç¡®å®šéœ€è¦è¯»å–çš„ç›®å½•å’Œæ–‡ä»¶"
        - "åˆ—å‡ºå…³é”®æ–‡ä»¶æ¸…å•"

    step_2_directory_exploration:
      description: "ä½¿ç”¨ MCP å·¥å…·æ¢ç´¢ç›®å½•ç»“æ„"
      mcp_tools:
        - "list_directory: åˆ—å‡ºç›®å½•å†…å®¹"
        - "directory_tree: è·å–å®Œæ•´ç›®å½•æ ‘"
        - "search_files: æœç´¢ç‰¹å®šæ–‡ä»¶æ¨¡å¼"
      examples:
        - "åˆ—å‡º src/components/charts/ ç›®å½•"
        - "æœç´¢æ‰€æœ‰ *.tsx æ–‡ä»¶"
        - "è·å– src/ çš„å®Œæ•´ç›®å½•æ ‘"

    step_3_file_reading:
      description: "è¯»å–å…³é”®æ–‡ä»¶å†…å®¹"
      mcp_tools:
        - "read_text_file: è¯»å–æ–‡æœ¬æ–‡ä»¶"
        - "read_multiple_files: æ‰¹é‡è¯»å–å¤šä¸ªæ–‡ä»¶"
      priority_files:
        - "æ ¸å¿ƒç»„ä»¶æ–‡ä»¶"
        - "é…ç½®æ–‡ä»¶ï¼ˆtsconfig.json, package.jsonï¼‰"
        - "ç±»å‹å®šä¹‰æ–‡ä»¶"
        - "å…±äº«å·¥å…·/é…ç½®"
      examples:
        - "è¯»å– BaseChart.tsx äº†è§£å›¾è¡¨æ¶æ„"
        - "è¯»å– chartConfig.tsx äº†è§£é…ç½®ç»“æ„"
        - "è¯»å–ç›¸å…³ Hook æ–‡ä»¶"

    step_4_pattern_analysis:
      description: "åˆ†æä»£ç æ¨¡å¼å’Œæ¶æ„"
      actions:
        - "ç†è§£ç°æœ‰ä»£ç ç»“æ„"
        - "è¯†åˆ«è®¾è®¡æ¨¡å¼"
        - "æ‰¾å‡ºå‘½åè§„èŒƒ"
        - "åˆ†æä¾èµ–å…³ç³»"

    step_5_plan_formulation:
      description: "åŸºäºå®é™…ä»£ç åˆ¶å®šè¯¦ç»†æ–¹æ¡ˆ"
      include:
        - "å…·ä½“çš„æ–‡ä»¶è·¯å¾„"
        - "ä»£ç ç‰‡æ®µå¼•ç”¨"
        - "éµå¾ªç°æœ‰æ¨¡å¼"
        - "è¯¦ç»†å®æ–½æ­¥éª¤"

  mcp_tool_usage_patterns:
    when_to_use:
      list_directory:
        - "æ¢ç´¢ä¸ç†Ÿæ‚‰çš„ç›®å½•ç»“æ„"
        - "ç¡®è®¤ç›®å½•æ˜¯å¦å­˜åœ¨"
        - "åˆ—å‡ºå¯ç”¨çš„ç»„ä»¶/å·¥å…·"

      read_text_file:
        - "æŸ¥çœ‹å…·ä½“æ–‡ä»¶å†…å®¹"
        - "ç†è§£ä»£ç å®ç°ç»†èŠ‚"
        - "è·å–é…ç½®ä¿¡æ¯"

      search_files:
        - "æŸ¥æ‰¾ç‰¹å®šä»£ç æ¨¡å¼"
        - "å®šä½éœ€è¦ä¿®æ”¹çš„æ‰€æœ‰ä½ç½®"
        - "æœç´¢ç‰¹å®š import è¯­å¥"

      directory_tree:
        - "è·å–å®Œæ•´é¡¹ç›®ç»“æ„"
        - "ç†è§£æ¨¡å—ç»„ç»‡æ–¹å¼"

    syntax_examples:
      list_directory: |
        <use_mcp_tool>
        <server_name>github.com/modelcontextprotocol/servers/tree/main/src/filesystem</server_name>
        <tool_name>list_directory</tool_name>
        <arguments>
        {
          "path": "/home/mihari/Server/Aozaki/src/components/charts"
        }
        </arguments>
        </use_mcp_tool>

      read_text_file: |
        <use_mcp_tool>
        <server_name>github.com/modelcontextprotocol/servers/tree/main/src/filesystem</server_name>
        <tool_name>read_text_file</tool_name>
        <arguments>
        {
          "path": "/home/mihari/Server/Aozaki/src/components/charts/shared/BaseChart.tsx"
        }
        </arguments>
        </use_mcp_tool>

      search_files: |
        <use_mcp_tool>
        <server_name>github.com/modelcontextprotocol/servers/tree/main/src/filesystem</server_name>
        <tool_name>search_files</tool_name>
        <arguments>
        {
          "path": "/home/mihari/Server/Aozaki/src",
          "pattern": "import.*BaseChart",
          "excludePatterns": ["node_modules", "dist"]
        }
        </arguments>
        </use_mcp_tool>

  best_practices:
    - "åœ¨ç»™å‡ºæ–¹æ¡ˆå‰ï¼Œè‡³å°‘è¯»å– 2-3 ä¸ªç›¸å…³æ–‡ä»¶"
    - "ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼ˆ/home/mihari/Server/Aozaki/...ï¼‰"
    - "å…ˆæ¢ç´¢ç›®å½•ï¼Œå†è¯»å–æ–‡ä»¶"
    - "æ‰¹é‡è¯»å–å¤šä¸ªç›¸å…³æ–‡ä»¶"
    - "åŸºäºå®é™…ä»£ç åˆ¶å®šæ–¹æ¡ˆï¼Œè€Œéå‡è®¾"

  anti_patterns:
    - "âŒ åœ¨æ²¡æœ‰è¯»å–æ–‡ä»¶çš„æƒ…å†µä¸‹çŒœæµ‹ä»£ç ç»“æ„"
    - "âŒ ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆä¼šå¯¼è‡´ 'Access denied' é”™è¯¯ï¼‰"
    - "âŒ è·³è¿‡æ–‡ä»¶è¯»å–ç›´æ¥ç»™å‡ºæ–¹æ¡ˆ"
    - "âŒ åŸºäº environment_details çš„æ–‡ä»¶åˆ—è¡¨å°±è®¤ä¸ºäº†è§£äº†ä»£ç "

  example_workflow:
    task: "æ·»åŠ ä¸€ä¸ªæ–°çš„æ¸©åº¦å›¾è¡¨ç»„ä»¶"
    steps:
      - step: "æ¢ç´¢å›¾è¡¨ç›®å½•"
        tool: "list_directory"
        path: "/home/mihari/Server/Aozaki/src/components/charts"

      - step: "è¯»å– BaseChart æºç "
        tool: "read_text_file"
        path: "/home/mihari/Server/Aozaki/src/components/charts/shared/BaseChart.tsx"

      - step: "è¯»å–ç°æœ‰æ¸©åº¦ç›¸å…³å›¾è¡¨"
        tool: "read_text_file"
        path: "/home/mihari/Server/Aozaki/src/components/charts/TempChart.tsx"

      - step: "è¯»å–å›¾è¡¨é…ç½®"
        tool: "read_text_file"
        path: "/home/mihari/Server/Aozaki/src/components/charts/shared/chartConfig.tsx"

      - step: "åˆ¶å®šè¯¦ç»†æ–¹æ¡ˆ"
        action: "åŸºäºè¯»å–çš„ä»£ç ç»“æ„ï¼Œåˆ¶å®šç¬¦åˆç°æœ‰æ¨¡å¼çš„å®ç°æ–¹æ¡ˆ"

  success_criteria:
    - "æ–¹æ¡ˆä¸­åŒ…å«å…·ä½“çš„æ–‡ä»¶è·¯å¾„"
    - "æ–¹æ¡ˆå¼•ç”¨äº†å®é™…è¯»å–çš„ä»£ç ç‰‡æ®µ"
    - "æ–¹æ¡ˆéµå¾ªé¡¹ç›®çš„ç°æœ‰æ¨¡å¼"
    - "åœ¨ ACT MODE å®æ–½æ—¶æ— éœ€å¤§å¹…è°ƒæ•´"

# =========================================================
# é¡¹ç›®å¼€å‘è§„åˆ™
# =========================================================
rules:
  # -----------------------------------------------------
  # ğŸ“¦ æŠ€æœ¯æ ˆä¸åŒ…ç®¡ç†
  # -----------------------------------------------------
  - id: tech-stack
    description: å¿…é¡»ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„æŠ€æœ¯æ ˆ
    priority: critical
    assert:
      astro: "5.x"          # âœ… ä¿®æ­£ä¸ºå®é™…ç‰ˆæœ¬
      react: "19.x"         # âœ… ä¿®æ­£ä¸ºå®é™…ç‰ˆæœ¬
      typescript: "5.x"
      tailwindcss: "4.x"
      recharts: "3.x"
    verify: |
      æ£€æŸ¥ package.json ä¸­çš„ä¾èµ–ç‰ˆæœ¬æ˜¯å¦åŒ¹é…

  - id: package-manager
    description: å¿…é¡»ä½¿ç”¨ Bun ä½œä¸ºåŒ…ç®¡ç†å™¨
    priority: critical
    require:
      - "bun.lockb"
    forbid:
      - "yarn.lock"
      - "package-lock.json"
      - "pnpm-lock.yaml"
    scripts:
      - "bun install"
      - "bun run dev"
      - "bun run build"
      - "bun run check:all"

  # -----------------------------------------------------
  # ğŸ“ é¡¹ç›®ç»“æ„ä¸è·¯å¾„åˆ«å
  # -----------------------------------------------------
  - id: path-aliases
    description: å¼ºåˆ¶ä½¿ç”¨è·¯å¾„åˆ«åå¯¼å…¥å†…éƒ¨æ¨¡å—
    priority: high
    enforce:
      - use_at_prefix: true           # ä½¿ç”¨ @/ å¯¼å…¥å†…éƒ¨æ¨¡å—
      - no_relative_imports: true     # ç¦æ­¢ ../../../ å½¢å¼
      - consistent_paths: true        # è·¯å¾„ä¿æŒä¸€è‡´
    examples:
      good: |
        import { nodeStore } from "@/lib/nodeStore";
        import { Button } from "@/components/ui/button";
        import type { Client } from "@/lib/types/komari";
      bad: |
        import { nodeStore } from "../../../lib/nodeStore";  # âŒ
        import { Button } from "../../components/ui/button"; # âŒ

  - id: file-structure
    description: å¼ºåˆ¶æ‰§è¡Œé¡¹ç›®æ–‡ä»¶ç»“æ„è§„èŒƒ
    priority: high
    structure:
      src/components/:
        - "React ç»„ä»¶ (*.tsx)"
        - "å¯åŒ…å«å­ç›®å½•ï¼ˆcharts/, ui/, overview/ï¼‰"
      src/hooks/: "è‡ªå®šä¹‰ Hooks (*.ts)"
      src/lib/: "å·¥å…·å‡½æ•°ã€Storeã€ç±»å‹å®šä¹‰"
      src/pages/: "Astro é¡µé¢ (*.astro)"
      src/styles/: "å…¨å±€æ ·å¼"
    forbid:
      - "src/ ä¸‹ç›´æ¥æ”¾ç½® .tsx æ–‡ä»¶"
      - "components/ ä¸‹æ”¾ç½®éç»„ä»¶æ–‡ä»¶"

  # -----------------------------------------------------
  # ğŸ§© å‘½åè§„èŒƒï¼ˆå¢å¼ºç‰ˆï¼‰
  # -----------------------------------------------------
  - id: naming-conventions
    description: ç»Ÿä¸€çš„å‘½åè§„èŒƒ
    priority: high
    patterns:
      component_file: "PascalCase.tsx"        # NodeCard.tsx
      component_name: "PascalCase"            # function NodeCard()
      hook_file: "camelCase.ts"               # useNodeStore.ts
      hook_name: "^use[A-Z][a-zA-Z]*$"       # useNodesData
      variable: "camelCase"                   # chartData, timeRange
      constant: "UPPER_SNAKE_CASE"           # CHART_CONFIG, API_URL
      type_interface: "PascalCase"           # Client, NodeStatus
      enum: "PascalCase"                     # TimeRange
      private_property: "^_[a-z]"            # _internalState
    examples:
      components: |
        âœ… NodeCard.tsx â†’ function NodeCard()
        âœ… ChartContainer.tsx â†’ function ChartContainer()
        âŒ nodeCard.tsx, node-card.tsx
      hooks: |
        âœ… useNodeStore.ts â†’ export function useNodesData()
        âœ… useAllChartsData.ts â†’ export function useAllChartsData()
        âŒ UseNodeStore.ts, use-node-store.ts
      constants: |
        âœ… CHART_CONFIG, DEFAULT_TIMEOUT
        âŒ chartConfig, default_timeout

  # -----------------------------------------------------
  # ğŸ“¥ å¯¼å…¥é¡ºåºï¼ˆå¢å¼ºç‰ˆï¼‰
  # -----------------------------------------------------
  - id: import-order
    description: ç»Ÿä¸€çš„å¯¼å…¥é¡ºåºå’Œåˆ†ç»„
    priority: medium
    order:
      1_react: "React æ ¸å¿ƒåº“"
      2_external: "ç¬¬ä¸‰æ–¹åº“ï¼ˆæŒ‰å­—æ¯åºï¼‰"
      3_internal_components: "@/components/"
      4_internal_hooks: "@/hooks/"
      5_internal_lib: "@/lib/"
      6_types: "ç±»å‹å¯¼å…¥ï¼ˆæ”¾æœ€åï¼‰"
    rules:
      - group_by_category: true
      - alphabetical_within_group: true
      - separate_with_blank_line: true
      - types_last: true
    examples:
      good: |
        import { useState, useMemo } from "react";

        import { Card } from "@/components/ui/card";
        import { LineChart, XAxis } from "recharts";

        import { ChartContainer } from "@/components/charts/ChartContainer";
        import { BaseChart } from "@/components/charts/shared/BaseChart";

        import { useNodesData } from "@/hooks/useNodeStore";

        import { formatBytes, cn } from "@/lib/utils";

        import type { Client, NodeStatus } from "@/lib/types/komari";

  # -----------------------------------------------------
  # âš›ï¸ React ç»„ä»¶å¼€å‘è§„èŒƒï¼ˆå¢å¼ºç‰ˆï¼‰
  # -----------------------------------------------------
  - id: react-component-rules
    description: React ç»„ä»¶å¼€å‘æœ€ä½³å®è·µ
    priority: high
    enforce:
      - must_use_typescript: true
      - prefer_function_components: true
      - prefer_named_exports: true
      - use_props_interface: true
      - explicit_return_types: false      # å¯æ¨æ–­æ—¶ä¸å¼ºåˆ¶

    memo_rules:
      - memo_expensive_components: true
      - memo_list_items: true
      - memo_chart_components: false      # å›¾è¡¨å·²ç”± BaseChart ä¼˜åŒ–

    hooks_rules:
      - useMemo_for_expensive_calculations: true
      - useCallback_for_child_props: true
      - exhaustive_deps: true             # ä¾èµ–æ•°ç»„å¿…é¡»å®Œæ•´
      - no_inline_functions: true         # é¿å…å†…è”å‡½æ•°

    examples:
      props_interface: |
        âœ… å¥½çš„åšæ³•ï¼š
        interface NodeCardProps {
          client: Client;
          status: NodeStatus | null;
        }
        export function NodeCard({ client, status }: NodeCardProps) { ... }

        âŒ åçš„åšæ³•ï¼š
        export function NodeCard({ client, status }: any) { ... }  # æ²¡æœ‰ç±»å‹
        export default function NodeCard(props) { ... }             # é»˜è®¤å¯¼å‡º

      useMemo_example: |
        âœ… æ­£ç¡®çš„ useMemo ä½¿ç”¨ï¼š
        const chartData = useMemo(
          () => transformData(data, timeRange),
          [data, timeRange]  # å®Œæ•´ä¾èµ–
        );

        âŒ é”™è¯¯ï¼š
        const chartData = transformData(data, timeRange);  # æ¯æ¬¡é‡æ–°è®¡ç®—

  # -----------------------------------------------------
  # ğŸ—ï¸ Astro ç»„ä»¶è§„èŒƒï¼ˆæ–°å¢ï¼‰
  # -----------------------------------------------------
  - id: astro-component-rules
    description: Astro ç»„ä»¶ç‰¹å®šè§„èŒƒ
    priority: high
    enforce:
      - use_layouts: true
      - client_directives_explicit: true
      - props_typed: true

    client_directives:
      - "client:load - é¡µé¢åŠ è½½æ—¶ç«‹å³åŠ è½½"
      - "client:idle - é¡µé¢ç©ºé—²æ—¶åŠ è½½"
      - "client:visible - å…ƒç´ å¯è§æ—¶åŠ è½½"
      - "client:only - ä»…å®¢æˆ·ç«¯æ¸²æŸ“"

    examples:
      good: |
        ---
        import BaseLayout from '@/layouts/BaseLayout.astro';
        import NodesGrid from '@/components/NodesGrid';
        ---
        <BaseLayout title="Nodes">
          <NodesGrid client:load />
        </BaseLayout>

      bad: |
        <NodesGrid />  # âŒ ç¼ºå°‘ client æŒ‡ä»¤

  # -----------------------------------------------------
  # ğŸ“Š å›¾è¡¨ç»„ä»¶è§„èŒƒï¼ˆä¼˜åŒ–ç‰ˆï¼‰
  # -----------------------------------------------------
  - id: chart-architecture
    description: åŸºäº BaseChart çš„ç»Ÿä¸€å›¾è¡¨æ¶æ„
    priority: critical
    enforce:
      - must_extend_BaseChart: true
      - use_transformData_pattern: true
      - use_renderChart_pattern: true
      - reuse_CHART_CONFIG: true
      - lowercase_config_keys: true       # xAxis, yAxis (å°å†™)
      - no_direct_ResponsiveContainer: true

    required_imports:
      - "BaseChart from '@/components/charts/shared/BaseChart'"
      - "CHART_CONFIG from '@/components/charts/shared/chartConfig'"
      - "recharts components (LineChart, AreaChart, etc.)"

    structure: |
      æ‰€æœ‰å›¾è¡¨å¿…é¡»é€šè¿‡ BaseChart å®ç°ï¼Œæä¾›ï¼š
      1. transformData: æ•°æ®è½¬æ¢å‡½æ•°
      2. renderChart: å›¾è¡¨æ¸²æŸ“å‡½æ•°
      3. ä½¿ç”¨å…±äº«çš„ CHART_CONFIG

    examples:
      correct_structure: |
        import { useMemo } from "react";
        import { LineChart, Line, XAxis, YAxis } from "recharts";
        import { BaseChart } from "@/components/charts/shared/BaseChart";
        import { CHART_CONFIG, CHART_COLORS } from "@/components/charts/shared/chartConfig";
        import type { BaseChartProps } from "@/components/charts/shared/chartConfig";

        export function CpuChart({ data, timeRange, onTimeRangeChange }: CpuChartProps) {
          const transformData = useMemo(
            () => (rawData: HistoryData[], range: number) => {
              // è½¬æ¢é€»è¾‘
            },
            []
          );

          return (
            <BaseChart
              data={data}
              timeRange={timeRange}
              onTimeRangeChange={onTimeRangeChange}
              transformData={transformData}
              renderChart={(chartData, { xAxis, yAxis, cartesianGrid, tooltip }) => (
                <LineChart data={chartData}>
                  <CartesianGrid {...cartesianGrid} />
                  <XAxis {...xAxis} />
                  <YAxis {...yAxis} />
                  <Line type="monotone" dataKey="value" stroke={CHART_COLORS.primary} />
                </LineChart>
              )}
            />
          );
        }

      config_keys_warning: |
        âš ï¸ æ³¨æ„é…ç½®åç§°å¿…é¡»å°å†™ï¼š
        âœ… { xAxis, yAxis, cartesianGrid, tooltip }
        âŒ { XAxis, YAxis }  # ä¼šä¸ç»„ä»¶åå†²çª

  - id: chart-gradients
    description: å›¾è¡¨æ¸å˜æ•ˆæœå¤ç”¨
    priority: medium
    enforce:
      - use_ChartGradients_component: true
      - reference_by_url: true
    examples:
      good: |
        import { ChartGradients } from "@/components/charts/shared/ChartGradients";

        <LineChart>
          <defs>
            <ChartGradients />
          </defs>
          <Area fill="url(#colorPrimary)" />
        </LineChart>

  # -----------------------------------------------------
  # ğŸ”Œ æ•°æ®ç®¡ç†è§„èŒƒï¼ˆä¼˜åŒ–ç‰ˆï¼‰
  # -----------------------------------------------------
  - id: data-management-architecture
    description: NodeStore å•ä¾‹æ¨¡å¼ + Hooks è®¢é˜…
    priority: critical
    architecture:
      global_store: "nodeStore (Singleton)"
      hooks_layer: "useNodesData, useNodeData, useAllChartsData"
      data_sources:
        dev: "HTTP è½®è¯¢ (1000ms)"
        prod: "WebSocket å®æ—¶æ¨é€"
        history: "HTTP RPC2"

    enforce:
      - use_nodeStore_singleton: true
      - no_direct_store_access: true      # å¿…é¡»é€šè¿‡ hooks
      - subscribe_pattern: true
      - cleanup_on_unmount: true

    forbidden:
      - "ç»„ä»¶ä¸­ç›´æ¥è°ƒç”¨ nodeStore.getClients()"
      - "ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ fetch/axios"
      - "useEffect ä¸­ç›´æ¥è½®è¯¢æ•°æ®"

  - id: hooks-usage-patterns
    description: æ•°æ® Hooks ç»Ÿä¸€è°ƒç”¨è§„èŒƒ
    priority: high
    hooks:
      useNodesData:
        description: "è·å–æ‰€æœ‰èŠ‚ç‚¹æ•°æ®"
        signature: "(refreshInterval?: number) => UseNodesDataResult"
        returns: "{ clients, statuses, loading, error, refresh }"
        example: |
          const { clients, statuses, loading } = useNodesData(1000);

      useNodeData:
        description: "è·å–å•ä¸ªèŠ‚ç‚¹æ•°æ®"
        signature: "(uuid: string, refreshInterval?: number) => UseNodeDataResult"
        returns: "{ client, status, loading, notFound, error, refresh }"
        example: |
          const { client, status, loading, notFound } = useNodeData(uuid, 1000);

      useAllChartsData:
        description: "è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å›¾è¡¨æ•°æ®"
        signature: "(uuid: string) => UseAllChartsDataResult"
        returns: "{ chartsData, timeRanges, setChartTimeRange, loading }"
        example: |
          const { chartsData, timeRanges, setChartTimeRange } = useAllChartsData(uuid);

  # -----------------------------------------------------
  # ğŸ§° å·¥å…·å‡½æ•°è§„èŒƒ
  # -----------------------------------------------------
  - id: utility-functions
    description: ç»Ÿä¸€çš„å·¥å…·å‡½æ•°ä½¿ç”¨
    priority: medium
    required_utils:
      formatting:
        - "formatBytes(bytes: number): string"
        - "formatPercent(value: number): string"
        - "formatSpeed(bytesPerSecond: number): string"
        - "formatTimestamp(timestamp: number): string"
      styling:
        - "cn(...inputs: ClassValue[]): string"  # Tailwind class merge

    import_from: "@/lib/utils"

    examples:
      good: |
        import { formatBytes, formatSpeed, cn } from "@/lib/utils";

        const usage = formatBytes(client.mem_used);
        const speed = formatSpeed(status.network_tx);
        const classes = cn("text-sm", isActive && "font-bold");

  # -----------------------------------------------------
  # ğŸ¨ UI ç»„ä»¶è§„èŒƒ
  # -----------------------------------------------------
  - id: ui-components
    description: shadcn/ui ç»„ä»¶ä½¿ç”¨è§„èŒƒ
    priority: high
    enforce:
      - prefer_shadcn_components: true
      - no_custom_basic_ui: true          # ä¸è‡ªå·±å®ç°åŸºç¡€ç»„ä»¶
      - consistent_variants: true

    available_components:
      - "Card, CardHeader, CardTitle, CardContent"
      - "Button"
      - "Badge"
      - "Select, SelectTrigger, SelectValue, SelectContent, SelectItem"
      - "Skeleton"
      - "Progress"
      - "Separator"

    import_from: "@/components/ui/*"

    examples:
      good: |
        import { Card, CardContent } from "@/components/ui/card";
        import { Badge } from "@/components/ui/badge";

      bad: |
        # âŒ ä¸è¦è‡ªå·±å®ç° Card ç»„ä»¶
        function CustomCard({ children }) { ... }

  # -----------------------------------------------------
  # ğŸš¨ é”™è¯¯ä¸çŠ¶æ€å¤„ç†ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
  # -----------------------------------------------------
  - id: error-handling
    description: ç»Ÿä¸€çš„é”™è¯¯å’ŒçŠ¶æ€å¤„ç†è§„èŒƒ
    priority: high
    states:
      loading: "æ˜¾ç¤º Skeleton ç»„ä»¶"
      error: "æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ + é‡è¯•æŒ‰é’®"
      empty: "æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º"
      success: "æ˜¾ç¤ºæ•°æ®å†…å®¹"

    enforce:
      - show_skeleton_on_loading: true
      - show_error_with_retry: true
      - show_empty_state: true
      - graceful_degradation: true
      - no_silent_failures: true

    examples:
      complete_pattern: |
        function NodeCard() {
          const { client, status, loading, error } = useNodeData(uuid);

          if (loading) return <NodeCardSkeleton />;
          if (error) return <ErrorState error={error} onRetry={refresh} />;
          if (!client) return <EmptyState message="èŠ‚ç‚¹ä¸å­˜åœ¨" />;

          return <Card>{/* æ­£å¸¸å†…å®¹ */}</Card>;
        }

  # -----------------------------------------------------
  # âš¡ æ€§èƒ½ä¼˜åŒ–è§„èŒƒï¼ˆå¯é‡åŒ–ï¼‰
  # -----------------------------------------------------
  - id: performance-optimization
    description: æ€§èƒ½ä¼˜åŒ–çš„å…·ä½“è¦æ±‚
    priority: high
    targets:
      bundle_size: "< 500KB (gzipped)"
      first_paint: "< 1.5s"
      time_to_interactive: "< 3s"
      lighthouse_score: "> 90"

    enforce:
      - memoize_chart_data: true
      - memoize_expensive_calculations: true
      - no_inline_objects_in_jsx: true
      - no_inline_functions_in_jsx: true
      - reuse_chart_configs: true
      - lazy_load_routes: true
      - code_splitting: true

    examples:
      inline_objects_bad: |
        # âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
        <Component style={{ color: 'red' }} />
        <Component onClick={() => handleClick()} />

      inline_objects_good: |
        # âœ… æå–åˆ°å¤–éƒ¨æˆ–ä½¿ç”¨ useMemo/useCallback
        const style = useMemo(() => ({ color: 'red' }), []);
        const onClick = useCallback(() => handleClick(), []);
        <Component style={style} onClick={onClick} />

  # -----------------------------------------------------
  # ğŸ”’ ç±»å‹å®‰å…¨è§„èŒƒï¼ˆæ–°å¢ï¼‰
  # -----------------------------------------------------
  - id: type-safety
    description: TypeScript ç±»å‹å®‰å…¨æœ€ä½³å®è·µ
    priority: critical
    enforce:
      - no_any: true
      - no_implicit_any: true
      - strict_null_checks: true
      - no_non_null_assertion: false      # å…è®¸ ! ä½†éœ€è°¨æ…
      - prefer_interfaces_for_objects: true
      - prefer_type_for_unions: true

    naming:
      interfaces: "PascalCase (Client, NodeStatus)"
      types: "PascalCase (TimeRange, ChartData)"
      generics: "T, U, V æˆ–æè¿°æ€§åç§° (TData, TConfig)"

    examples:
      good: |
        interface Client {
          uuid: string;
          name: string;
          platform: string;
        }

        type TimeRange = 1 | 3 | 6 | 12 | 24;

        function getData<T>(items: T[]): T | null {
          return items[0] ?? null;
        }

      bad: |
        const data: any = fetchData();  # âŒ ç¦æ­¢ any
        const result = data!.value;     # âš ï¸ è°¨æ…ä½¿ç”¨ !

  # -----------------------------------------------------
  # ğŸ¯ ä»£ç è´¨é‡ä¿è¯
  # -----------------------------------------------------
  - id: code-quality
    description: ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·é“¾
    priority: high
    tools:
      linting: "ESLint (eslint.config.js)"
      formatting: "Prettier (.prettierrc)"
      type_checking: "TypeScript (tsconfig.json)"
      bundle_analysis: "Astro build --analyze"

    scripts:
      - "bun run lint         # ESLint æ£€æŸ¥"
      - "bun run lint:fix     # è‡ªåŠ¨ä¿®å¤"
      - "bun run format       # Prettier æ ¼å¼åŒ–"
      - "bun run format:check # æ ¼å¼æ£€æŸ¥"
      - "bun run check        # Astro + TypeScript æ£€æŸ¥"
      - "bun run check:all    # å®Œæ•´æ£€æŸ¥æµç¨‹"

    pre_commit:
      - "bun run check:all    # æäº¤å‰å¿…é¡»é€šè¿‡"

    ci_cd:
      - "bun run check:all"
      - "bun run build"

  # -----------------------------------------------------
  # ğŸ“ å“åº”å¼è®¾è®¡è§„èŒƒï¼ˆæ–°å¢ï¼‰
  # -----------------------------------------------------
  - id: responsive-design
    description: Mobile-First å“åº”å¼è®¾è®¡
    priority: high
    approach: "mobile-first"
    breakpoints:
      sm: "640px"
      md: "768px"
      lg: "1024px"
      xl: "1280px"
      "2xl": "1536px"

    enforce:
      - mobile_first_classes: true
      - test_all_breakpoints: true
      - no_fixed_widths: true

    examples:
      good: |
        # âœ… Mobile-first æ–¹å¼
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3">

      bad: |
        # âŒ å›ºå®šå®½åº¦
        <div className="w-[500px]">

  # -----------------------------------------------------
  # ğŸ”„ Git å·¥ä½œæµè§„èŒƒï¼ˆæ–°å¢ï¼‰
  # -----------------------------------------------------
  - id: git-workflow
    description: Git æäº¤å’Œåˆ†æ”¯ç®¡ç†è§„èŒƒ
    priority: medium
    commit_format: "type(scope): subject"
    commit_types:
      feat: "æ–°åŠŸèƒ½"
      fix: "Bug ä¿®å¤"
      docs: "æ–‡æ¡£æ›´æ–°"
      style: "ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰"
      refactor: "é‡æ„"
      perf: "æ€§èƒ½ä¼˜åŒ–"
      test: "æµ‹è¯•"
      chore: "æ„å»º/å·¥å…·é“¾"

    examples:
      - "feat(charts): add CPU temperature chart"
      - "fix(hooks): resolve memory leak in useNodeData"
      - "refactor(components): extract common chart logic"
      - "perf(charts): optimize data transformation"

  # -----------------------------------------------------
  # ğŸ’¡ å¼€å‘å“²å­¦ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
  # -----------------------------------------------------
  - id: development-philosophy
    description: é¡¹ç›®æ ¸å¿ƒä»·å€¼è§‚
    priority: medium
    principles:
      code_quality:
        - "ç±»å‹å®‰å…¨ï¼šä¸¥æ ¼çš„ TypeScript"
        - "ä»£ç æ¸…æ™°ï¼šè‡ªè§£é‡Šçš„å‘½åå’Œç»“æ„"
        - "æ˜“ç»´æŠ¤ï¼šDRY åŸåˆ™å’Œæ¨¡å—åŒ–"

      performance:
        - "é¦–å±é€Ÿåº¦ï¼š< 1.5s"
        - "äº¤äº’å“åº”ï¼š< 100ms"
        - "å†…å­˜ç®¡ç†ï¼šé¿å…æ³„æ¼å’Œè¿‡åº¦æ¸²æŸ“"

      user_experience:
        - "å¹³æ»‘åŠ è½½ï¼šSkeleton å ä½"
        - "é”™è¯¯å‹å¥½ï¼šæ¸…æ™°çš„é”™è¯¯æç¤ºå’Œæ¢å¤é€‰é¡¹"
        - "å“åº”å¼ï¼šæ‰€æœ‰è®¾å¤‡å®Œç¾ä½“éªŒ"

      developer_experience:
        - "å·¥å…·å®Œå–„ï¼šLint + Format + Type Check"
        - "æ–‡æ¡£é½å…¨ï¼šä»£ç æ³¨é‡Šå’Œè§„åˆ™è¯´æ˜"
        - "å¿«é€Ÿåé¦ˆï¼šçƒ­é‡è½½å’Œå¿«é€Ÿæ„å»º"

  # -----------------------------------------------------
  # ğŸ“ å­¦ä¹ èµ„æºï¼ˆæ–°å¢ï¼‰
  # -----------------------------------------------------
  - id: learning-resources
    description: æ¨èçš„å­¦ä¹ å’Œå‚è€ƒèµ„æº
    priority: low
    resources:
      astro: "https://docs.astro.build"
      react: "https://react.dev"
      typescript: "https://www.typescriptlang.org/docs"
      tailwindcss: "https://tailwindcss.com/docs"
      recharts: "https://recharts.org"
      shadcn: "https://ui.shadcn.com"

# =========================================================
# è§„åˆ™ç‰ˆæœ¬å†å²
# =========================================================
# v1.0 - 2025-10-16
#   - ä¿®æ­£æŠ€æœ¯æ ˆç‰ˆæœ¬ï¼ˆAstro 5.x, React 19.xï¼‰
#   - ç®€åŒ– MCP é…ç½®
#   - æ–°å¢è·¯å¾„åˆ«åã€Astro ç»„ä»¶ã€ç±»å‹å®‰å…¨ã€å“åº”å¼è®¾è®¡è§„èŒƒ
#   - ä¼˜åŒ–å›¾è¡¨ç»„ä»¶ã€æ•°æ®ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–è§„èŒƒ
#   - æ·»åŠ  Git å·¥ä½œæµå’Œå­¦ä¹ èµ„æº
# =========================================================
