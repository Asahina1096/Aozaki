---
description: "Komari Aozaki é¡¹ç›®å¼€å‘è§„èŒƒ - MCP ä¼˜å…ˆ + ç±»å‹å®‰å…¨ + æ€§èƒ½ä¼˜åŒ–"
author: "Asahina1096"
version: "1.8.0"
globs:
  - "**/*.tsx"
  - "**/*.ts"
  - "**/*.astro"
  - "src/**/*"
tags: ["react", "astro", "typescript", "tailwindcss", "mcp", "performance"]
last_updated: "2025-01-17"
---

# .clinerules - Komari Aozaki å¼€å‘è§„èŒƒ

**æŠ€æœ¯æ ˆ**: Astro 5.x â€¢ React 19 â€¢ TypeScript 5 â€¢ TailwindCSS 4 â€¢ shadcn/ui â€¢ Recharts 3
**åŒ…ç®¡ç†å™¨**: Bun 1.3.x (å”¯ä¸€)
**æ ¸å¿ƒåŸåˆ™**: MCP ä¼˜å…ˆ â€¢ ç±»å‹å®‰å…¨ â€¢ æ€§èƒ½å‹å¥½ â€¢ ä½“éªŒè‡³ä¸Š

## æ ¸å¿ƒæŒ‡æ ‡

**æ€§èƒ½ç›®æ ‡**:
- é¦–å±æ¸²æŸ“ (First Paint): < 1.5s
- äº¤äº’å“åº” (Interaction): < 100ms
- å¯äº¤äº’æ—¶é—´ (TTI): < 3s
- Bundle ä½“ç§¯: < 500KB (gzip)
- Lighthouse è¯„åˆ†: > 90

**è´¨é‡ä¿è¯**:
- ç±»å‹å®‰å…¨: ç¦æ­¢ `any`ï¼Œå¯ç”¨ `strictNullChecks`
- ä»£ç è´¨é‡: æäº¤å‰å¿…é¡»é€šè¿‡ `bun run check:all`
- æµ‹è¯•éªŒè¯: æœ¬åœ°æµ‹è¯• + å“åº”å¼éªŒè¯ + æ§åˆ¶å°é›¶é”™è¯¯

## MCP æœåŠ¡å™¨ - å·¥å…·ä¼˜å…ˆåŸåˆ™

**æ ¸å¿ƒåŸåˆ™**: èƒ½ç”¨ MCP å°±ç”¨ MCPï¼Œé¿å…é‡å¤é€ è½®å­

### Context7 - æ–‡æ¡£ä¸æœ€ä½³å®è·µæ£€ç´¢ (CRITICAL)

**å¼ºåˆ¶ä½¿ç”¨åœºæ™¯**:
- âœ… ä½¿ç”¨ä»»ä½•ä¸ç†Ÿæ‚‰çš„ API/Hook/ç»„ä»¶å‰
- âœ… é‡åˆ°ç‰ˆæœ¬å‡çº§/å…¼å®¹æ€§é—®é¢˜æ—¶
- âœ… éœ€è¦æœ€ä½³å®è·µå‚è€ƒæ—¶
- âœ… å®ç°æ–°åŠŸèƒ½å‰æŸ¥è¯å®˜æ–¹æ–¹æ¡ˆ

**æ”¯æŒåº“**:
```yaml
astro: /withastro/docs
react: /facebook/react
recharts: /recharts/recharts
tailwindcss: /tailwindlabs/tailwindcss
typescript: /microsoft/typescript
```

**å·¥ä½œæµ**: `resolve-library-id` â†’ `get-library-docs` â†’ å¼•ç”¨å®˜æ–¹å»ºè®®åˆ¶å®šæ–¹æ¡ˆ

**è§¦å‘å…³é”®è¯**: ä¸ç¡®å®šã€ä¸çŸ¥é“ã€å¦‚ä½•ã€APIã€å‡½æ•°ã€Hookã€propsã€æœ€ä½³å®è·µã€ä¼˜åŒ–ã€ç‰ˆæœ¬ã€å…¼å®¹

**åæ¨¡å¼** âŒ:
- å‡­è®°å¿†å†™ä»£ç ä¸æŸ¥æ–‡æ¡£
- ä½¿ç”¨è¿‡æ—¶/ä¸æ¨èçš„ API
- å¿½ç•¥ç‰ˆæœ¬å·®å¼‚å¯¼è‡´é—®é¢˜

### Fetch MCP - ç½‘é¡µå†…å®¹è·å– (HIGH)

**ä½¿ç”¨åœºæ™¯**:
- å¤–éƒ¨æ–‡æ¡£/ç½‘é¡µæŸ¥çœ‹
- API å“åº”å†…å®¹è·å–
- HTML â†’ Markdown è½¬æ¢
- å…¬å¼€ä¿¡æ¯çˆ¬å–

**å·¥å…·**: `fetch_html` | `fetch_markdown` | `fetch_txt` | `fetch_json`

**ç‰¹æ€§**: è‡ªå®šä¹‰è¯·æ±‚å¤´ â€¢ æœ€å¤§é•¿åº¦é™åˆ¶ â€¢ åˆ†é¡µè·å–

**åæ¨¡å¼** âŒ:
- ç”¨ curl/wget æ‰‹åŠ¨è§£æ
- å¿½è§† MCP åŸç”Ÿ Markdown è½¬æ¢

### å†³ç­–æµç¨‹

```
ä»»åŠ¡å¼€å§‹ â†’ æ˜¯å¦æœ‰ MCP å·¥å…·ï¼Ÿ
         â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ MCP å·¥å…·
         â””â”€ å¦ â†’ è¯„ä¼°å¿…è¦æ€§ â†’ ä¼ ç»Ÿå·¥å…·
```

**ç¤ºä¾‹å¯¹æ¯”**:

| åœºæ™¯ | âŒ é”™è¯¯ | âœ… æ­£ç¡® |
|------|---------|---------|
| æŸ¥çœ‹ React 19 æ–° API | å‡­è®°å¿†/æœç´¢å¼•æ“ | `context7: resolve-library-id + get-library-docs` |
| è·å–ç½‘é¡µå†…å®¹ | `execute_command: curl \| html2text` | `fetch-mcp: fetch_markdown` |

## å·¥ä½œæµç¨‹

### PLAN MODE

**MCP ä¼˜å…ˆ**: âœ… å¯ç”¨

**å¿…é¡»æ‰§è¡Œ**:
1. ã€CRITICALã€‘ä»»ä½• API/åº“ä½¿ç”¨å‰ â†’ `context7` ç¡®è®¤
2. è®¡åˆ’å¼•ç”¨çœŸå®è·¯å¾„ã€ç°æœ‰æ¨¡å¼ã€é¢„æœŸè¾“å‡º
3. æ–‡æ¡£ç¡®è®¤æµç¨‹: `context7: resolve-library-id â†’ get-library-docs`
4. æ•´åˆåˆ†æ­¥è®¡åˆ’ï¼Œæ˜ç¡®è¦æ”¹çš„æ–‡ä»¶ä¸æ–¹æ³•

**ç¦æ­¢** âŒ:
- è·³è¿‡ MCP å·¥å…·ç›´æ¥ç”¨ä¼ ç»Ÿå‘½ä»¤
- ä¸æŸ¥æ–‡æ¡£å‡­å°è±¡å†™ä»£ç 

### ACT MODE

**MCP ä¼˜å…ˆ**: âœ… å¯ç”¨

**å¿…é¡»æ‰§è¡Œ**:
1. ã€CRITICALã€‘å®ç°å‰ â†’ `context7` ç¡®è®¤ API/æœ€ä½³å®è·µ
2. ã€MANDATORYã€‘é‡ç–‘é—® â†’ ç«‹å³æŸ¥è¯¢ `context7`ï¼Œä¸å‡è®¾
3. å®ç°å®Œæˆ â†’ å¯¹ç…§å®˜æ–¹ç¤ºä¾‹/å…¼å®¹è¯´æ˜
4. å¿…è¦æ—¶è¡¥å……ç‰ˆæœ¬å·®å¼‚å¤‡æ³¨

**ç¦æ­¢** âŒ:
- å‡­è®°å¿†ä½¿ç”¨å¯èƒ½å·²å˜æ›´çš„ API

### è‡ªåŠ¨è§¦å‘å™¨

**ä»»åŠ¡å¼€å§‹æ£€æŸ¥**:
- [ ] æ˜¯å¦éœ€è¦æŸ¥è¯¢æ–‡æ¡£ï¼Ÿï¼ˆæ–° API/ä¸ç†Ÿæ‚‰çš„åº“ï¼‰
- [ ] æ˜¯å¦éœ€è¦è·å–å¤–éƒ¨å†…å®¹ï¼Ÿï¼ˆç”¨ fetch-mcpï¼‰

**Context7 è§¦å‘è¯**: ä¸ç¡®å®šã€ä¸çŸ¥é“ã€å¦‚ä½•ã€æ˜¯å¦ã€APIã€æ–¹æ³•ã€å‡½æ•°ã€ç»„ä»¶ã€Hookã€propsã€å‚æ•°ã€æœ€ä½³å®è·µã€ä¼˜åŒ–ã€æ€§èƒ½ã€ç¤ºä¾‹ã€å…¼å®¹ã€ç‰ˆæœ¬ã€å‡çº§ã€è¿ç§»

**Context7 æ‰§è¡Œæµ**:
1. è¯†åˆ«è§¦å‘æº â†’ ç¡®å®šå¯¹åº”åº“
2. `resolve-library-id` â†’ `get-library-docs`
3. æ ¹æ®æ–‡æ¡£è°ƒæ•´æ–¹æ¡ˆ/å®ç°
4. è®°å½•ç»“è®ºä¸å¼•ç”¨å‡ºå¤„

**Fetch è§¦å‘è¯**: ç½‘é¡µã€URLã€HTTPã€API å“åº”ã€HTMLã€å¤–éƒ¨æ–‡æ¡£

**Fetch æ‰§è¡Œè§„åˆ™**:
- âŒ ç¦æ­¢: `curl`/`wget` æ‰‹åŠ¨å¤„ç†
- âœ… å¼ºåˆ¶: ä½¿ç”¨ `fetch-mcp` å·¥å…·
- ğŸ’¡ æ¨è: `fetch_markdown` è‡ªåŠ¨è½¬æ¢

### æµ‹è¯•éªŒè¯

**æœ€ä½³å®è·µ**:
- âœ… æœ¬åœ°æµ‹è¯•å¼€å‘æœåŠ¡å™¨
- âœ… éªŒè¯å“åº”å¼è®¾è®¡ï¼ˆæ‰€æœ‰æ–­ç‚¹ï¼‰
- âœ… æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ï¼ˆé›¶å®¹å¿ï¼‰
- âœ… æ— éªŒè¯ä¸æäº¤

**åæ¨¡å¼** âŒ:
- è·³è¿‡æµ‹è¯•æˆ–å¿½ç•¥æ§åˆ¶å°é”™è¯¯
- æœªéªŒè¯å“åº”å¼å°±æäº¤

## å¼€å‘è§„èŒƒ

### 1. æŠ€æœ¯æ ˆçº¦æŸ

**å›ºå®šç‰ˆæœ¬**:
- Astro 5.x
- React 19.x
- TypeScript 5.x
- TailwindCSS 4.x
- Recharts 3.x

**åŒ…ç®¡ç†å™¨**:
- âœ… å”¯ä¸€: `bun.lockb`
- âŒ ç¦æ­¢: `yarn.lock`, `package-lock.json`, `pnpm-lock.yaml`

### 2. å¯¼å…¥è§„èŒƒ

**è·¯å¾„åˆ«å**: å¼ºåˆ¶ä½¿ç”¨ `@/`ï¼Œç¦æ­¢ `../../../`

**å¯¼å…¥é¡ºåº**:
```typescript
// 1. React
import React, { useState } from 'react'

// 2. ç¬¬ä¸‰æ–¹åº“
import { clsx } from 'clsx'

// 3. @ åˆ«å (components â†’ hooks â†’ lib)
import { Button } from '@/components/ui/button'
import { useNodeData } from '@/hooks/useNodeStore'
import { cn } from '@/lib/utils'

// 4. ç±»å‹ï¼ˆæœ€åï¼‰
import type { NodeData } from '@/lib/types/komari'
```

### 3. å‘½åè§„èŒƒ

| ç±»å‹ | è§„åˆ™ | ç¤ºä¾‹ |
|------|------|------|
| ç»„ä»¶æ–‡ä»¶ | PascalCase.tsx | `NodeCard.tsx` |
| Hook æ–‡ä»¶ | camelCase.ts | `useNodeStore.ts` |
| ç»„ä»¶å¯¼å‡º | PascalCase | `export function NodeCard()` |
| Hook å¯¼å‡º | useXxx | `export function useNodeData()` |
| å˜é‡ | camelCase | `const nodeData = ...` |
| å¸¸é‡ | UPPER_SNAKE_CASE | `const MAX_RETRIES = 3` |
| ç±»å‹/æ¥å£ | PascalCase | `interface NodeData` |

### 4. React ç»„ä»¶

**å¿…é¡»**:
- âœ… TypeScript + å‘½åå¯¼å‡º
- âœ… Props å»ºç«‹ `interface`/`type`
- âœ… æ˜‚è´µè®¡ç®— â†’ `useMemo`
- âœ… ä¼ é€’å›è°ƒ â†’ `useCallback`
- âœ… Effect ä¾èµ–å®Œæ•´
- âŒ é¿å… JSX å†…è”å‡½æ•°/å¯¹è±¡ï¼ˆé™¤é trivialï¼‰

**ç¤ºä¾‹**:
```typescript
interface NodeCardProps {
  nodeId: string
  onSelect?: (id: string) => void
}

export function NodeCard({ nodeId, onSelect }: NodeCardProps) {
  const data = useMemo(() => transformData(nodeId), [nodeId])
  const handleClick = useCallback(() => onSelect?.(nodeId), [nodeId, onSelect])

  return <div onClick={handleClick}>{data}</div>
}
```

### 5. Astro ç»„ä»¶

- å¸ƒå±€å¤ç”¨
- `client:*` æŒ‡ä»¤æ˜ç¡®
- Props ç±»å‹åŒ–

### 6. å›¾è¡¨æ¶æ„

**ç»Ÿä¸€ç»§æ‰¿**: `BaseChart`

**è§„èŒƒ**:
- âœ… `transformData` + `useMemo`
- âœ… `renderChart` å›è°ƒè¾“å‡º Recharts ç»„ä»¶
- âœ… å¤ç”¨ `CHART_CONFIG` / `CHART_GRADIENTS`
- âœ… é…ç½®é”®å°å†™

### 7. æ•°æ®ç®¡ç†

**æ¨¡å¼**: `nodeStore` å•ä¾‹ + Hooks è®¿é—®

**è§„èŒƒ**:
- âœ… ç»„ä»¶å±‚ï¼šåªé€šè¿‡ `useNodesData` / `useNodeData` / `useAllChartsData` è·å–æ•°æ®
- âœ… Hooks å±‚ï¼šå¯ç›´æ¥è°ƒç”¨ `nodeStore` æ–¹æ³•ï¼ˆå¦‚ `start()`, `getHttpClient()` ç­‰ï¼‰
- âŒ ç»„ä»¶å±‚ï¼šç¦æ­¢ç›´æ¥è®¿é—® `nodeStore` æˆ–å‘èµ·è½®è¯¢
- âœ… è®¢é˜…éœ€æ¸…ç†

### 8. å·¥å…·å‡½æ•°

**é›†ä¸­ä½ç½®**: `@/lib/utils`

**æ¨èå‡½æ•°**: `formatBytes` | `formatPercent` | `formatSpeed` | `formatTimestamp` | `cn`

### 9. UI ç»„ä»¶

**é»˜è®¤åŸºç¡€**: shadcn/ui (`@/components/ui/*`)

**è§„èŒƒ**:
- âœ… ä¼˜å…ˆä½¿ç”¨ç°æœ‰ç»„ä»¶
- âœ… ä¿æŒ variants ä¸€è‡´
- âœ… ç›´æ¥å¤ç”¨: `Skeleton` | `Badge` | `Select` | `Progress`

### 10. çŠ¶æ€å¤„ç†

**ç»Ÿä¸€æ¨¡å¼**:
- `loading` â†’ `Skeleton` / `Placeholder`
- `error` â†’ å‹å¥½æç¤º + é‡è¯•æŒ‰é’®
- `empty` â†’ æ˜ç¡®æ–‡æ¡ˆ
- âŒ ç¦æ­¢é™é»˜å¤±è´¥

### 11. æ€§èƒ½ä¼˜åŒ–

**é‡åŒ–ç›®æ ‡**:
- Bundle: < 500KB (gzip)
- First paint: < 1.5s
- TTI: < 3s
- Lighthouse: > 90

**å®æ–½ç­–ç•¥**:
- âœ… Memoize chart data / æ˜‚è´µè®¡ç®—
- âœ… å¤ç”¨é…ç½®/å¸¸é‡
- âœ… æ‡’åŠ è½½è·¯ç”± + ä»£ç æ‹†åˆ†
- âŒ ç¦æ­¢ JSX å†…è”å¯¹è±¡/å‡½æ•°

### 12. ç±»å‹å®‰å…¨

**ä¸¥æ ¼æ¨¡å¼**:
- âŒ ç¦æ­¢ `any` / implicit any
- âœ… å¯ç”¨ `strictNullChecks`
- âš ï¸ æ…ç”¨éç©ºæ–­è¨€ (`!`)
- ğŸ’¡ å¯¹è±¡ç»“æ„ â†’ `interface`ï¼Œè”åˆç±»å‹ â†’ `type`
- ğŸ’¡ æ³›å‹å‘½åæ¸…æ™°: `TData`, `TResponse`

### 13. ä»£ç è´¨é‡

**å·¥å…·é“¾**:
```bash
bun run lint          # ESLint æ£€æŸ¥
bun run lint:fix      # è‡ªåŠ¨ä¿®å¤
bun run format        # Prettier æ ¼å¼åŒ–
bun run format:check  # æ ¼å¼æ£€æŸ¥
bun run check         # TypeScript ç±»å‹æ£€æŸ¥
bun run check:all     # å®Œæ•´æ£€æŸ¥ï¼ˆå¿…é¡»é€šè¿‡ï¼‰
```

**æµç¨‹**:
- Pre-commit: `bun run check:all`
- CI/CD: `bun run check:all` + `bun run build`

### 14. å“åº”å¼è®¾è®¡

**ç­–ç•¥**: Mobile-first + Tailwind æ–­ç‚¹

**æ–­ç‚¹**: `sm` (640px) | `md` (768px) | `lg` (1024px) | `xl` (1280px) | `2xl` (1536px)

**è§„èŒƒ**:
- âœ… ä¼˜å…ˆ mobile-first ç±»å
- âœ… æµ‹è¯•æ‰€æœ‰æ–­ç‚¹
- âŒ ç¦æ­¢å›ºå®šå®½åº¦

### 15. Git æäº¤

**è§„èŒƒ**: Conventional Commits

**æ ¼å¼**: `type(scope): subject`

**ç±»å‹**: `feat` | `fix` | `docs` | `style` | `refactor` | `perf` | `test` | `chore`

**ç¤ºä¾‹**:
```
feat(charts): æ·»åŠ  GPU æ¸©åº¦å›¾è¡¨
fix(nodeStore): ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜
docs(readme): æ›´æ–°å®‰è£…è¯´æ˜
```

## å¼€å‘å“²å­¦

1. **MCP å·¥å…·ä¼˜å…ˆ** - èƒ½ç”¨ MCP å°±ç”¨ MCPï¼Œé¿å…é‡å¤é€ è½®å­
2. **ç±»å‹å®‰å…¨ + å¯ç»´æŠ¤** - ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼Œæ¸…æ™°ä»£ç ç»“æ„
3. **æ€§èƒ½å‹å¥½ + ä½“éªŒä¼˜å…ˆ** - é‡åŒ–æŒ‡æ ‡ï¼ŒæŒç»­ä¼˜åŒ–
4. **æ–‡æ¡£åŒ– + å¿«é€Ÿåé¦ˆ** - å®Œå–„æ³¨é‡Šï¼ŒåŠæ—¶éªŒè¯
