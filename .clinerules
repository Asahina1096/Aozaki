---
description: "Komari Aozaki é¡¹ç›®å¼€å‘è§„èŒƒ - MCP ä¼˜å…ˆ + ç±»å‹å®‰å…¨ + æ€§èƒ½ä¼˜åŒ–"
author: "Asahina1096"
version: "2.0.0"
globs:
  - "**/*.tsx"
  - "**/*.ts"
  - "**/*.astro"
  - "src/**/*"
tags: ["react", "astro", "typescript", "tailwindcss", "mcp", "performance"]
last_updated: "2025-01-17"
---

# .clinerules - Komari Aozaki å¼€å‘è§„èŒƒ

**æŠ€æœ¯æ ˆ**: Astro 5.x â€¢ React 19 â€¢ TypeScript 5 â€¢ TailwindCSS 4 â€¢ shadcn/ui â€¢ Recharts 3
**åŒ…ç®¡ç†å™¨**: Bun 1.3.x (å”¯ä¸€)
**æ ¸å¿ƒåŸåˆ™**: MCP ä¼˜å…ˆ â€¢ ç±»å‹å®‰å…¨ â€¢ æ€§èƒ½å‹å¥½ â€¢ ä½“éªŒè‡³ä¸Š

## æ ¸å¿ƒæŒ‡æ ‡

**æ€§èƒ½ç›®æ ‡**:
- é¦–å±æ¸²æŸ“ (First Paint): < 1.5s
- äº¤äº’å“åº” (Interaction): < 100ms
- å¯äº¤äº’æ—¶é—´ (TTI): < 3s
- Bundle ä½“ç§¯: < 500KB (gzip)
- Lighthouse è¯„åˆ†: > 90

**è´¨é‡ä¿è¯**:
- ç±»å‹å®‰å…¨: ç¦æ­¢ `any`ï¼Œå¯ç”¨ `strictNullChecks`
- ä»£ç è´¨é‡: æäº¤å‰å¿…é¡»é€šè¿‡ `bun run check:all`
- æµ‹è¯•éªŒè¯: æœ¬åœ°æµ‹è¯• + å“åº”å¼éªŒè¯ + æ§åˆ¶å°é›¶é”™è¯¯

## MCP æœåŠ¡å™¨ - å·¥å…·ä¼˜å…ˆåŸåˆ™

**æ ¸å¿ƒåŸåˆ™**: èƒ½ç”¨ MCP å°±ç”¨ MCPï¼Œé¿å…é‡å¤é€ è½®å­

### Context7 - æ–‡æ¡£ä¸æœ€ä½³å®è·µæ£€ç´¢ (CRITICAL)

**å¼ºåˆ¶ä½¿ç”¨åœºæ™¯**:
- âœ… ä½¿ç”¨ä»»ä½•ä¸ç†Ÿæ‚‰çš„ API/Hook/ç»„ä»¶å‰
- âœ… é‡åˆ°ç‰ˆæœ¬å‡çº§/å…¼å®¹æ€§é—®é¢˜æ—¶
- âœ… éœ€è¦æœ€ä½³å®è·µå‚è€ƒæ—¶
- âœ… å®ç°æ–°åŠŸèƒ½å‰æŸ¥è¯å®˜æ–¹æ–¹æ¡ˆ

**æ”¯æŒåº“**:
```yaml
astro: /withastro/docs
react: /facebook/react
recharts: /recharts/recharts
tailwindcss: /tailwindlabs/tailwindcss
typescript: /microsoft/typescript
```

**å·¥ä½œæµ**: `resolve-library-id` â†’ `get-library-docs` â†’ å¼•ç”¨å®˜æ–¹å»ºè®®åˆ¶å®šæ–¹æ¡ˆ

**è§¦å‘å…³é”®è¯**: ä¸ç¡®å®šã€ä¸çŸ¥é“ã€å¦‚ä½•ã€APIã€å‡½æ•°ã€Hookã€propsã€æœ€ä½³å®è·µã€ä¼˜åŒ–ã€ç‰ˆæœ¬ã€å…¼å®¹

### Fetch MCP - ç½‘é¡µå†…å®¹è·å– (HIGH)

**ä½¿ç”¨åœºæ™¯**:
- å¤–éƒ¨æ–‡æ¡£/ç½‘é¡µæŸ¥çœ‹
- API å“åº”å†…å®¹è·å–
- HTML â†’ Markdown è½¬æ¢
- å…¬å¼€ä¿¡æ¯çˆ¬å–

**å·¥å…·**: `fetch_html` | `fetch_markdown` | `fetch_txt` | `fetch_json`

### Git Tools - ç‰ˆæœ¬æ§åˆ¶ç®¡ç† (HIGH)

**ä½¿ç”¨åœºæ™¯**:
- Git çŠ¶æ€æ£€æŸ¥ / åˆ†æ”¯ç®¡ç†
- ä»£ç æäº¤ / æš‚å­˜æ“ä½œ
- Diff æŸ¥çœ‹ / ä»£ç å†å²
- åˆ†æ”¯åˆ›å»º / åˆ‡æ¢

**æ ¸å¿ƒå·¥å…·**: `git_status` | `git_add` | `git_commit` | `git_diff` | `git_branch` | `git_checkout` | `git_log` | `git_show`

### Sequential Thinking - å¤æ‚é—®é¢˜åˆ†æ (ACT MODE ONLY)

**é™åˆ¶**: ä»…åœ¨ ACT MODE ä¸‹ä½¿ç”¨

**ä½¿ç”¨åœºæ™¯**:
- âœ… å¤æ‚é—®é¢˜åˆ†è§£å’Œæ­¥éª¤è§„åˆ’
- âœ… éœ€è¦åŠ¨æ€åæ€å’Œè°ƒæ•´è§£å†³æ–¹æ¡ˆæ—¶
- âœ… å¤šæ­¥éª¤è§£å†³æ–¹æ¡ˆè®¾è®¡
- âœ… ä¸ç¡®å®šå®Œæ•´èŒƒå›´çš„é—®é¢˜åˆ†æ
- âœ… éœ€è¦éªŒè¯å‡è®¾çš„å¤æ‚ä»»åŠ¡

**æ ¸å¿ƒå·¥å…·**: `sequentialthinking`

**ç‰¹ç‚¹**:
- åŠ¨æ€è°ƒæ•´æ€è€ƒæ­¥éª¤
- æ”¯æŒä¿®æ­£å’Œåˆ†æ”¯æ€è€ƒ
- ç”Ÿæˆå’ŒéªŒè¯è§£å†³æ–¹æ¡ˆå‡è®¾
- é€‚åº”æ€§é—®é¢˜è§£å†³æµç¨‹

**åæ¨¡å¼** âŒ:
- å‡­è®°å¿†å†™ä»£ç ä¸æŸ¥æ–‡æ¡£
- ç”¨ `curl`/`wget` æ‰‹åŠ¨è§£æç½‘é¡µ
- æ‰‹åŠ¨ `execute_command: git` å‘½ä»¤
- åœ¨ PLAN MODE ä¸‹ä½¿ç”¨ Sequential Thinking

## æŠ€æœ¯æ ˆä¸åŒ…ç®¡ç†

**å›ºå®šç‰ˆæœ¬**:
- Astro 5.x
- React 19.x
- TypeScript 5.x
- TailwindCSS 4.x
- Recharts 3.x

**åŒ…ç®¡ç†å™¨**:
- âœ… å”¯ä¸€: `bun.lockb`
- âŒ ç¦æ­¢: `yarn.lock`, `package-lock.json`, `pnpm-lock.yaml`

## ä»£ç è§„èŒƒ

### å¯¼å…¥è§„èŒƒ

**è·¯å¾„åˆ«å**: å¼ºåˆ¶ä½¿ç”¨ `@/`ï¼Œç¦æ­¢ `../../../`

**å¯¼å…¥é¡ºåº**:
```typescript
// 1. React
import React, { useState } from 'react'

// 2. ç¬¬ä¸‰æ–¹åº“
import { clsx } from 'clsx'

// 3. @ åˆ«å (components â†’ hooks â†’ lib)
import { Button } from '@/components/ui/button'
import { useNodeData } from '@/hooks/useNodeStore'
import { cn } from '@/lib/utils'

// 4. ç±»å‹ï¼ˆæœ€åï¼‰
import type { NodeData } from '@/lib/types/komari'
```

### å‘½åè§„èŒƒ

| ç±»å‹ | è§„åˆ™ | ç¤ºä¾‹ |
|------|------|------|
| ç»„ä»¶æ–‡ä»¶ | PascalCase.tsx | `NodeCard.tsx` |
| Hook æ–‡ä»¶ | camelCase.ts | `useNodeStore.ts` |
| ç»„ä»¶å¯¼å‡º | PascalCase | `export function NodeCard()` |
| Hook å¯¼å‡º | useXxx | `export function useNodeData()` |
| å˜é‡ | camelCase | `const nodeData = ...` |
| å¸¸é‡ | UPPER_SNAKE_CASE | `const MAX_RETRIES = 3` |
| ç±»å‹/æ¥å£ | PascalCase | `interface NodeData` |

### React ç»„ä»¶

**å¿…é¡»**:
- âœ… TypeScript + å‘½åå¯¼å‡º
- âœ… Props å»ºç«‹ `interface`/`type`
- âœ… æ˜‚è´µè®¡ç®— â†’ `useMemo`
- âœ… ä¼ é€’å›è°ƒ â†’ `useCallback`
- âœ… Effect ä¾èµ–å®Œæ•´
- âŒ é¿å… JSX å†…è”å‡½æ•°/å¯¹è±¡ï¼ˆé™¤é trivialï¼‰

**ç¤ºä¾‹**:
```typescript
interface NodeCardProps {
  nodeId: string
  onSelect?: (id: string) => void
}

export function NodeCard({ nodeId, onSelect }: NodeCardProps) {
  const data = useMemo(() => transformData(nodeId), [nodeId])
  const handleClick = useCallback(() => onSelect?.(nodeId), [nodeId, onSelect])

  return <div onClick={handleClick}>{data}</div>
}
```

### Astro ç»„ä»¶

- å¸ƒå±€å¤ç”¨
- `client:*` æŒ‡ä»¤æ˜ç¡®
- Props ç±»å‹åŒ–

## é¡¹ç›®æ¶æ„

### å›¾è¡¨æ¶æ„

**ç»Ÿä¸€ç»§æ‰¿**: `BaseChart`

**è§„èŒƒ**:
- âœ… `transformData` + `useMemo`
- âœ… `renderChart` å›è°ƒè¾“å‡º Recharts ç»„ä»¶
- âœ… å¤ç”¨ `CHART_CONFIG` / `CHART_GRADIENTS`
- âœ… é…ç½®é”®å°å†™

### æ•°æ®ç®¡ç†

**æ¨¡å¼**: `nodeStore` å•ä¾‹ + Hooks è®¿é—®

**è§„èŒƒ**:
- âœ… ç»„ä»¶å±‚ï¼šåªé€šè¿‡ `useNodesData` / `useNodeData` / `useAllChartsData` è·å–æ•°æ®
- âœ… Hooks å±‚ï¼šå¯ç›´æ¥è°ƒç”¨ `nodeStore` æ–¹æ³•ï¼ˆå¦‚ `start()`, `getHttpClient()` ç­‰ï¼‰
- âŒ ç»„ä»¶å±‚ï¼šç¦æ­¢ç›´æ¥è®¿é—® `nodeStore` æˆ–å‘èµ·è½®è¯¢
- âœ… è®¢é˜…éœ€æ¸…ç†

### UI ç»„ä»¶

**é»˜è®¤åŸºç¡€**: shadcn/ui (`@/components/ui/*`)

**è§„èŒƒ**:
- âœ… ä¼˜å…ˆä½¿ç”¨ç°æœ‰ç»„ä»¶
- âœ… ä¿æŒ variants ä¸€è‡´
- âœ… ç›´æ¥å¤ç”¨: `Skeleton` | `Badge` | `Select` | `Progress`

### çŠ¶æ€å¤„ç†

**ç»Ÿä¸€æ¨¡å¼**:
- `loading` â†’ `Skeleton` / `Placeholder`
- `error` â†’ å‹å¥½æç¤º + é‡è¯•æŒ‰é’®
- `empty` â†’ æ˜ç¡®æ–‡æ¡ˆ
- âŒ ç¦æ­¢é™é»˜å¤±è´¥

### å·¥å…·å‡½æ•°

**é›†ä¸­ä½ç½®**: `@/lib/utils`

**æ¨èå‡½æ•°**: `formatBytes` | `formatPercent` | `formatSpeed` | `formatTimestamp` | `cn`

## ç±»å‹å®‰å…¨ä¸æ€§èƒ½

### ç±»å‹å®‰å…¨

**ä¸¥æ ¼æ¨¡å¼**:
- âŒ ç¦æ­¢ `any` / implicit any
- âœ… å¯ç”¨ `strictNullChecks`
- âš ï¸ æ…ç”¨éç©ºæ–­è¨€ (`!`)
- ğŸ’¡ å¯¹è±¡ç»“æ„ â†’ `interface`ï¼Œè”åˆç±»å‹ â†’ `type`
- ğŸ’¡ æ³›å‹å‘½åæ¸…æ™°: `TData`, `TResponse`

### æ€§èƒ½ä¼˜åŒ–

**é‡åŒ–ç›®æ ‡**:
- Bundle: < 500KB (gzip)
- First paint: < 1.5s
- TTI: < 3s
- Lighthouse: > 90

**å®æ–½ç­–ç•¥**:
- âœ… Memoize chart data / æ˜‚è´µè®¡ç®—
- âœ… å¤ç”¨é…ç½®/å¸¸é‡
- âœ… æ‡’åŠ è½½è·¯ç”± + ä»£ç æ‹†åˆ†
- âŒ ç¦æ­¢ JSX å†…è”å¯¹è±¡/å‡½æ•°

### å“åº”å¼è®¾è®¡

**ç­–ç•¥**: Mobile-first + Tailwind æ–­ç‚¹

**æ–­ç‚¹**: `sm` (640px) | `md` (768px) | `lg` (1024px) | `xl` (1280px) | `2xl` (1536px)

**è§„èŒƒ**:
- âœ… ä¼˜å…ˆ mobile-first ç±»å
- âœ… æµ‹è¯•æ‰€æœ‰æ–­ç‚¹
- âŒ ç¦æ­¢å›ºå®šå®½åº¦

## è´¨é‡ä¿è¯å·¥å…·é“¾

**å·¥å…·é“¾**:
```bash
bun run lint          # ESLint æ£€æŸ¥
bun run lint:fix      # è‡ªåŠ¨ä¿®å¤
bun run format        # Prettier æ ¼å¼åŒ–
bun run format:check  # æ ¼å¼æ£€æŸ¥
bun run check         # TypeScript ç±»å‹æ£€æŸ¥
bun run check:all     # å®Œæ•´æ£€æŸ¥ï¼ˆå¿…é¡»é€šè¿‡ï¼‰
```

**æµç¨‹**:
- Pre-commit: `bun run check:all`
- CI/CD: `bun run check:all` + `bun run build`

## Git æäº¤è§„èŒƒ

**è§„èŒƒ**: Conventional Commits

**æ ¼å¼**: `type(scope): subject`

**ç±»å‹**: `feat` | `fix` | `docs` | `style` | `refactor` | `perf` | `test` | `chore`

**ç¤ºä¾‹**:
```
feat(charts): æ·»åŠ  GPU æ¸©åº¦å›¾è¡¨
fix(nodeStore): ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜
docs(readme): æ›´æ–°å®‰è£…è¯´æ˜
```

## å¼€å‘å“²å­¦

1. **MCP å·¥å…·ä¼˜å…ˆ** - èƒ½ç”¨ MCP å°±ç”¨ MCPï¼Œé¿å…é‡å¤é€ è½®å­
2. **ç±»å‹å®‰å…¨ + å¯ç»´æŠ¤** - ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼Œæ¸…æ™°ä»£ç ç»“æ„
3. **æ€§èƒ½å‹å¥½ + ä½“éªŒä¼˜å…ˆ** - é‡åŒ–æŒ‡æ ‡ï¼ŒæŒç»­ä¼˜åŒ–
4. **æ–‡æ¡£åŒ– + å¿«é€Ÿåé¦ˆ** - å®Œå–„æ³¨é‡Šï¼ŒåŠæ—¶éªŒè¯
